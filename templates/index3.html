<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Recommendation</title>
    <!-- FlaskでのCSSファイルのリンク -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div id="container">
        <h1>楽曲レコメンド</h1>

        <!-- ジャンル選択フォーム -->
        <form id="recommendation-form">
            <label for="genre">ジャンルを選択してください:</label>
            <select id="genre" name="genre">
                <option value="">--選択してください--</option>
                <option value="pop">ポップ</option>
                <option value="rock">ロック</option>
                <option value="hip-hop">ヒップホップ</option>
                <option value="jazz">ジャズ</option>
                <option value="edm">EDM</option>
            </select>
            <button type="button" id="submit-button">楽曲を推薦</button>
            <!-- エラーメッセージを表示する要素 -->
            <p id="error-message" class="hidden">ジャンルを選択してください。</p>
        </form>
        <div id="recommendations">
            <h2>推薦結果</h2>
            <ul id="recommendation-list"></ul>
        </div>
    </div>
    
    <script>
        document.getElementById('submit-button').addEventListener('click', function () {
            const genre = document.getElementById('genre').value;
            const errorMessage = document.getElementById('error-message');
            const recommendationList = document.getElementById('recommendation-list');
            recommendationList.innerHTML = ""; // 推薦結果をリセット
    
            if (!genre) {
                errorMessage.classList.remove('hidden');
            } else {
                errorMessage.classList.add('hidden');
                // Fetch APIでサーバーにリクエストを送信
                fetch(`/recommend?genre=${encodeURIComponent(genre)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            errorMessage.textContent = data.error;
                            errorMessage.classList.remove('hidden');
                        } else {
                            data.forEach(item => {
                                const listItem = document.createElement('li');
                                listItem.innerHTML = `<a href="${item.track_url}" target="_blank">${item.track_name} - ${item.artist_name}</a>`;
                                recommendationList.appendChild(listItem);
                            });
                        }
                    })
                    .catch(err => {
                        console.error('Error:', err);
                        errorMessage.textContent = "エラーが発生しました。";
                        errorMessage.classList.remove('hidden');
                    });
            }
        });
    </script>
</body>
</html>
